<!DOCTYPE html>
<html>
<head>
    <title>Job Shop Schedule</title>
    <style>
        table { border-collapse: collapse; width: 80%; margin: 20px auto; }
        th, td { border: 1px solid black; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .reschedule-btn { 
            display: inline-block; 
            padding: 10px 20px; 
            background-color: #4CAF50; 
            color: white; 
            text-decoration: none; 
            border: none; 
            cursor: pointer; 
            margin: 10px 0; 
        }
        .reschedule-btn:hover { background-color: #45a049; }
        #terminal { 
            width: 600px; 
            height: 200px; 
            background: #000; 
            color: #0f0; 
            font-family: 'Courier New', Courier, monospace; 
            text-align: left; 
            padding: 10px; 
            margin: 20px auto; 
            border: 1px solid #333; 
            overflow-y: auto; 
            white-space: pre-wrap; 
        }
    </style>
</head>
<body>
    <h1>Job Shop Schedule</h1>
    <a href="/" class="reschedule-btn">Reschedule</a>

    <h2>Tasks Ordered by Start Time</h2>
    <table>
        <tr>
            <th>Task Segment ID</th>
            <th>Job</th>
            <th>Description</th>
            <th>Machines</th>
            <th>Humans</th>
            <th>Start Time</th>
            <th>End Time</th>
        </tr>
        {% for segment in segments %}
        <tr>
            <td>{{ segment.task_id }}</td>
            <td>{{ segment.job_id }}</td>
            <td>{{ segment.description }}</td>
            <td>{{ segment.machines }}</td>
            <td>{{ segment.humans }}</td>
            <td>{{ segment.start.strftime('%Y-%m-%d %I:%M %p') }}</td>
            <td>{{ segment.end.strftime('%Y-%m-%d %I:%M %p') }}</td>
        </tr>
        {% endfor %}
    </table>

    <h2>Job Completion Dates</h2>
    <table>
        <tr>
            <th>Job</th>
            <th>Description</th>
            <th>Client</th>
            <th>Promised Date</th>
            <th>Completion Date</th>
            <th>Days Late</th>
            <th>Rand-days Late</th>
        </tr>
        {% for job_id, info in job_completions.items() %}
        {% set days_late = ((info.completion - info.promised_date).total_seconds() / 86400) | round(2) %}
        {% set rand_days_late = days_late * info.unit_price * info.quantity if days_late > 0 else 0 %}
        <tr>
            <td>{{ job_id }}</td>
            <td>{{ info.description }}</td>
            <td>{{ info.client }}</td>
            <td>{{ info.promised_date.strftime('%Y-%m-%d %I:%M %p') }}</td>
            <td>{{ info.completion.strftime('%Y-%m-%d %I:%M %p') }}</td>
            <td>{{ days_late }}</td>
            <td>{{ rand_days_late | round(2) }}</td>
        </tr>
        {% endfor %}
    </table>

    <div id="terminal">
        {{ log_output }}
    </div>
</body>
</html>